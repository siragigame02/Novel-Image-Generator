# 📘 小説画像化ツール 仕様書（GUI付き）

## 🧩 概要

本ツールは、挿絵付きの小説テキストからCG集形式の画像を自動生成するPythonスクリプトです。
初心者でも扱えるよう、GUIベースで操作可能。DLSite等での販売を想定したJPEG出力が可能です。

---

## 🖼 GUI 画面構成

| 項目         | 型              | 初期値       | 説明                       |
| ---------- | -------------- | --------- | ------------------------ |
| フォントファイル   | ファイル選択（`.ttf`） | ―         | テキスト描画に使用するフォント（縦書き対応推奨） |
| フォントサイズ    | 数値             | 48        | 文字のサイズ（px）               |
| フォントカラー    | 色選択（HEX）       | `#000000` | テキストの色                   |
| 最大文字数（横書き） | 数値             | 35        | 横書きで1行に描画する最大文字数         |
| 画像フォルダ     | フォルダ選択         | ―         | 挿絵画像（`001.png`等）を格納      |
| テキストファイル   | ファイル選択（`.txt`） | ―         | 小説本文（UTF-8）              |
| 出力フォルダ名    | テキスト入力         | ―         | `output/作品名/` の形式で保存される  |
| 出力実行ボタン    | ボタン            | ―         | 指定に基づき画像を生成              |

---

## 💬 セリフ設定項目（縦書き吹き出し用）

| 項目       | 型              | 初期値                | 説明               |
| -------- | -------------- | ------------------ | ---------------- |
| セリフフォント  | ファイル選択（`.ttf`） | ―                  | セリフ専用フォント（縦書き推奨） |
| セリフフォント色 | 色選択（HEX）       | `#2A2A2A`          | セリフの文字色          |
| セリフ枠線色   | 色選択（HEX）       | `#3C4C6A`          | 吹き出し枠の色          |
| セリフ背景色   | 色＋透過度          | `#FFFFFF`, 30 | セリフ背景（半透明矩形）+透過度％     |

---

## 📝 ナレーション設定項目（地の文）

| 項目          | 型        | 初期値       | 説明                   |
| ----------- | -------- | --------- | -------------------- |
| ナレーション背景カラー | 色選択（HEX） | `#003232` | 画面全体に敷く半透明背景の色       |
| ナレーション背景透過度 | 数値（%）    | 30     | 背景の透明度（0〜100%）       |
| ナレーション文字配置  | 選択肢      | 中央寄せ      | `左寄せ / 中央 / 右寄せ` を選択 |
| ナレーション横書き  | 選択肢      | 横書き      | `横書き / 縦書き` を選択 |

---

## 📄 テキストファイル内の特殊タグと処理ルール

### `[scene:001]`

* 挿絵画像（例：`画像フォルダ/001.png`）を読み込む
* 直後の行が空なら画像のみ出力（文字なし）

### `[para]`

* 強制改ページ（新しい画像ファイルを出力）

### セリフ（縦書き吹き出し）

* `「～」` で囲まれた文がセリフとして認識される
* **1つの `[scene:X]` に対して最大2つのセリフ**を許容
* **順番で配置：**

  * 1つ目 → 右上寄り
  * 2つ目 → 左下寄り
* セリフがない場合はナレーションとして処理

### ナレーション（横書き）

* `[para]` のあと、セリフでないテキストが対象
* 横書き＋背景暗転処理を行う

---

## 🖼 出力仕様

| 項目      | 内容                                |
| ------- | --------------------------------- |
| 出力形式    | `.jpg`（固定、将来的に`.png`対応可）          |
| 解像度     | `960x1280 px`                  |
| 保存先     | `output/作品フォルダ名/`                 |
| ファイル名形式 | `作品名_001.jpg`, `作品名_002.jpg`, ... |

---

## 🔄 出力例の挙動

```txt
[scene:001]

「ずっと待ってたんだから……」
「私も直人君のこと、ちっちゃい頃から好きだったよ」
[para]
そう言って、彼女は涙ぐんだ
```

→

* `001.png` を背景に使用
* `output/作品フォルダ名/001.jpg`を出力（そのまま出力）
* 「ずっと待ってた…」を右側に縦書き吹き出し
* 「私も…」を左側に縦書き吹き出し
* `output/作品フォルダ名/002.jpg`を出力(セリフが入った画像)
* `output/作品フォルダ名/003.jpg`上から暗めの透過レイヤーで覆ってナレーションが入った画像を出力

---

```txt
[scene:002]

彼女は目を細めて、何かを噛みしめるように微笑んだ。
```

→

* `002.png` を背景に使用
* 上から暗めの透過レイヤーを重ねナレーションを横書きで中央表示

---

```txt
[scene:003]
（空行）
```

→

* `003.png` をそのまま使用
* **文字なしの純粋な切替画像として出力**

---

## ✅ 追加仕様：GUI設定の保存・読み込み機能

### 🎯目的：

* ユーザーが一度入力したフォントやカラーなどの情報を、再度立ち上げた時に**自動的に復元**
* 複数作品を並行制作する際にも**設定ファイルを切り替えることで使い回し可能**

---

## 🧩 仕様詳細

| 機能         | 内容                                       |
| ---------- | ---------------------------------------- |
| 🔽 保存タイミング | 出力ボタン押下時、自動的に保存（明示ボタンも可能）                |
| 📄 保存形式    | `YAML`（推奨）または `XML`（代替案）                 |
| 📁 保存場所    | `config/settings.yaml`（デフォルト）            |
| 🆙 起動時の挙動  | `settings.yaml` が存在すれば**自動読み込み**し、GUIに反映 |

---

## 📝 設定ファイルの構成例（YAML）

```yaml
font_path: "C:/Windows/Fonts/meiryo.ttc"
font_size: 48
font_color: "#000000"

serif_font_path: "C:/Fonts/SoukouMincho.ttf"
serif_font_color: "#2A2A2A"
serif_bg_color: "#FFFFFF"
serif_bg_alpha: 180
serif_border_color: "#3C4C6A"

narration_bg_color: "#003232"
narration_bg_alpha: 30
narration_text_align: "center"

max_chars: 35
last_image_folder: "C:/Users/User/images"
last_text_file: "C:/Users/User/novel.txt"
last_output_folder: "MyNovel"
```

---

## 🔧 実装方針（参考）

* 起動時：
  `if os.path.exists("config/settings.yaml"):` で読み込み
* 保存時：
  `yaml.dump(current_settings, open("config/settings.yaml", "w"))`
* ライブラリ：
  `PyYAML` を使用（`pip install pyyaml`）

---

## ✅ GUIに追加するオプション（仕様）

| 項目               | 内容                         |
| ---------------- | -------------------------- |
| 📁 設定保存ファイル      | `settings.yaml` |
| 💾 明示的な保存ボタン（任意） | `現在の設定を保存`                 |
| 📤 明示的な読込ボタン（任意） | `設定を読み込む`（複数プリセット運用想定）     |

---

了解です、シラギさん！
ここでは現在までの仕様をもとに、最終的な**Pythonスクリプトのモジュール構成案と各モジュールの役割**を明確に整理しておきます。今後の実装・分業・拡張にも役立つ「構成図メモ」になります。

---

# 🧩 小説画像化スクリプト：モジュール構成と役割一覧

---

## 📁 全体構成イメージ（予定ディレクトリ）

```
novel_image_generator/
├── main.py                # メイン起動スクリプト（GUI起動）
├── config/
│   └── settings.yaml      # 最後の設定保存ファイル
├── core/
│   ├── parser.py          # テキストファイルの解析（scene/para/セリフ検出など）
│   ├── renderer.py        # 画像の描画処理（背景・文字・吹き出しなど）
│   ├── layout.py          # テキストの縦書き・横書き処理＆座標計算
│   └── utils.py           # 色変換・透過変換・ファイル名補助など
├── gui/
│   └── gui_main.py        # TkinterベースのGUI定義
├── output/
│   └── （作品ごとの画像フォルダ）
└── assets/
    └── default_fonts/     # デフォルトフォントなど（任意）
```

---

## 🔹 モジュール一覧と役割

### `main.py`

| 内容        | 説明                        |
| --------- | ------------------------- |
| エントリーポイント | スクリプト実行時に最初に動く            |
| 設定読み込み    | `settings.yaml`を読み、GUIに反映 |
| GUI起動     | `gui.gui_main` を起動する      |

---

### `gui/gui_main.py`

| 内容      | 説明                              |
| ------- | ------------------------------- |
| GUI構成   | フォント・色・サイズなど入力フィールドを定義（Tkinter） |
| イベント処理  | 出力ボタン押下時の処理を呼び出す                |
| 設定保存・読込 | YAML形式で設定ファイルを管理（PyYAML使用）      |

---

### `core/parser.py`

| 内容                          | 説明                                   |
| --------------------------- | ------------------------------------ |
| テキストの読み込み                   | UTF-8の小説本文を読み込む                      |
| `[scene:xxx]`, `[para]` の判定 | 各ページの境界や画像の切替ポイント抽出                  |
| セリフとナレーションの分類               | `「～」` によるセリフ抽出と順序整理                  |
| 出力用構造体への変換                  | sceneごとのデータ構造（例：`SceneBlock`）に変換して返す |

---

### `core/renderer.py`

| 内容        | 説明                             |
| --------- | ------------------------------ |
| 背景画像の読み込み | 指定された画像（例：`003.png`）を開く        |
| ナレーション描画  | 背景に暗転レイヤー＋横書きテキスト              |
| セリフ描画     | 縦書き＋吹き出し枠（背景・枠・フォント）を座標指定で描画   |
| 画像保存      | `output/作品名/作品名_001.jpg` として保存 |

---

### `core/layout.py`

| 内容         | 説明                          |
| ---------- | --------------------------- |
| 文字の改行制御    | 最大文字数に応じた自動折り返し（横／縦）        |
| 各要素の配置計算   | セリフの位置（右上／左下）、パディング、行間などの調整 |
| 吹き出しサイズの計算 | セリフの行数に応じて自動リサイズする枠を算出      |

---

### `core/utils.py`

| 内容         | 説明                                      |
| ---------- | --------------------------------------- |
| HEX→RGBA変換 | `#003232` + 30% → `(0,50,50,76)` のような変換 |
| 透過度の整数変換   | 30% → `int(30/100 * 255)` に変換           |
| ファイル名補助    | `001`, `002` のような連番作成、パス操作補助            |
| 色指定の正規化    | GUIで受け取った文字列をRGBAに整形（安全性向上）             |

---

## 🔧 その他ツール／ライブラリ想定

| ライブラリ          | 用途           | 備考                   |
| -------------- | ------------ | -------------------- |
| `tkinter`      | GUI構築        | Windowsに標準搭載（軽量）     |
| `Pillow`       | 画像描画／保存      | 文字描画、画像合成、透過処理など     |
| `PyYAML`       | 設定ファイルの保存・読込 | `pip install pyyaml` |
| `textwrap`     | テキストの自動折り返し  | Python標準ライブラリ        |
| `os / pathlib` | パス・ファイル操作    | クロスプラットフォーム対応のため     |

---


